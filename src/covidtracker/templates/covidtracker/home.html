{% extends 'covidtracker/base.html' %}
{% load static %}


{% block content %}
<div class="section-bg pt-5 pb-5 px-5" id="introduction">
    <div class="container mt-2">
      <br>
      <div><h1 class="title-a text-center headingtext">COVID | CASES | INDIA = {{Totalcases}}</h1>
      <hr class="titlehr" />
    </div>
</div>
<header ></header >
  <h1 align="center" style="color: Orange"><b> Search Cases in your city</b></h1>

<form class="form-horizontal" id="find_cases" action={% url 'search' %} method = "GET">
    <div class="form-group">
      <label class="control-label col-sm-2" for="state" style="color: white">State:</label>
        <div class="col-sm-10">
          <input  list = "states" class="form-control" type="Text" name="state" id="state" placeholder="Enter State">
            <datalist  id="states">
              {% for state in states_cases %}
                <option value="{{state}}">{{state}}</option>
              {% endfor %}
            </datalist>
        </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2" for="city" style="color: white">City:</label>
        <div class="col-sm-10">
            <input  list = "cities" class="form-control" type ="Text" name="city" id="city" placeholder="Enter city , (First few letters of your city)">
            <datalist  id="cities">
              <option></option>
            </datalist>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button type="submit" class="btn btn-info">Find</button>
        </div>
      </div>
</form>

<h1 align ="center"style="color: green" ><b> Cases in Each State</b></h1>

<div class="section-bg pt-5 pb-5 px-5" id="introduction">
  <div class="container">

  <table  class="table table-striped table-dark" border=1 width=100%>
  <thead class= "thead-dark">
  <tr>
    <th>Sr No.</th>
    <th>State</th>
    <th>Confirmed </th>
    <th>Deaths</th>
    <th>Recovered</th>
    <th>Active</th>
  </tr>
  </thead>
  <tbody>
    {% for state in states_cases %}
    <tr>
      <td>{{state.pk}}</td>
      <td>{{state.state_name}}</td>
      <td>{{state.confirmed}}</td>
      <td>{{state.Death}}</td>
      <td>{{state.Recovered}}</td>
      <td>{{state.Active}}</td>
    </tr>
  {% endfor %}
  </tbody>
  </table>
  </div>
</div>

<br>
<div class="section-bg title-box">
  <div class="container">
      <div class="title-box text-center">
          <h3 class="title-a">
              ABOUT
          </h3>
          <hr class="titlehr" />
          <p class="font-italic "><br>{{about_intro|safe}}</p>
          <div class="text-dark text-center px-3">
              <h3 class="subtitle-a">*Contact*</h3>
              <p class="font-bold">Tushar Rao: <a href="https://github.com/tusharrao198/"><i  class="fa fa-github" aria-hidden="true">GTIHUB</i></a></p>
              <p class="fa fa-map-github"></p>
          </div>
      </div>
  </div>
</div>
{% endblock %}

{% block script %}
  <script type="text/javascript">
    let js = $.getJSON("https://api.covid19india.org/state_district_wise.json", "jsonp");
    // console.log("success");
    const my_form = document.querySelector("#city");
    my_form.addEventListener('mouseover', abcd);  
    // console.log(spaceData);
    var state_check_if_same = "";
    function abcd(e){
      e.preventDefault();
      if (Object.keys(js).length!=0)
        {
          const state = document.querySelector("#state");
          let state_name = state.value;
          console.log(state_name);
          if (state_name.length!=0 && state_check_if_same!=state_name)
          {
            state_check_if_same = state_name;
            // console.log(js["responseJSON"]);
            let options = js["responseJSON"][state_name]['districtData'];
            // console.log(Object.keys(options).length);
            let citi = [];

            for (let key in options) {
              citi.push(key);
            }
            console.log(citi);

            if (citi.length==0){
              console.log(`Data was not recieved for State = ${state_name}`)
            }
            let cities = document.querySelector("#cities");
            for(let i = 0; i < citi.length; i++) {
              let opt = citi[i];
              let el = document.createElement("option");
              el.textContent = opt;
              el.value = opt;
              cities.appendChild(el);
            }
          }
        }
    }
  </script>
{% endblock %}

