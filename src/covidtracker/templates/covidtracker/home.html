{% extends 'covidtracker/base.html' %}
{% load static %}


{% block content %}
<div class="section-bg pt-5 pb-5 px-5" id="introduction">
    <div class="container mt-2">
      <br>
      <div class="text-right"><h1 class="title-a text-center headingtext">COVID | CASES | INDIA </h1>Last Updated: {{present_date}} <hr class="titlehr" />
    </div>
</div>
<header ></header >

<div class="card-deck justify-content-center title-a text-center">
  <div class="card border-danger mb-2" style="max-width: 15rem;">
    <div class="card-header bg-transparent border-danger text-danger">Confirmed</div>
    <div class="card-body text-danger">
      <!-- <h5 class="card-title headingtext">Confirmed</h5> -->
      <p class="card-text">{{confirmed}}</p><p>+↑({{cases_increment}})</p>
    </div>
    <!-- <div class="card-footer bg-transparent border-success">Footer</div> -->
  </div>
  <div class="card border-danger mb-2" style="max-width: 15rem;">
    <div class="card-header bg-transparent border-danger text-danger">Deaths</div>
      <div class="card-body text-danger">
      <!-- <h5 class="card-title">Deaths</h5> -->
      <p class="card-text">{{Death}}</p><p>+↑({{death_inc}})</p>
    </div>
    <!-- <div class="card-footer bg-transparent border-success">Footer</div> -->
  </div>
  <div class="card border-success mb-2" style="max-width: 15rem;">
    <div class="card-header bg-transparent border-success text-success">Recovered</div>
    <div class="card-body text-success text-center">
      <!-- <h5 class="card-title">Recovered</h5> -->
      <p class="card-text">{{Recovered}}</p><p>+↑({{recovered_inc}})</p>
    </div>
    <!-- <div class="card-footer bg-transparent border-success">Footer</div> -->
  </div>
  <div class="card border-danger mb-2" style="max-width: 15rem;">
    <div class="card-header bg-transparent border-danger text-danger">Active</div>
    <div class="card-body text-danger text-center">
      <!-- <h5 class="card-title">Active</h5> -->
      <p class="card-text">{{Active}}</p>
    </div>
    <!-- <div class="card-footer bg-transparent border-success">Footer</div> -->
  </div>
</div>

<br>
  
  <h1 align="center" style="color: Orange"><b> Search Cases in your city</b></h1>
<div class="container">
<div class="msg"></div>
<form class="form-horizontal" id="find_cases" action={% url 'search' %} method = "GET">
    <div class="form-group">
      <label class="control-label col-sm-2" for="state" style="color: white">State:</label>
        <div class="col-sm-10">
          <input  list = "states" class="form-control" type="Text" name="state" id="state" placeholder="Enter State">
            <datalist  id="states">
              {% for state in states_cases %}
                <option value="{{state}}">{{state}}</option>
              {% endfor %}
            </datalist>
        </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2" for="city" style="color: white">City:</label>
        <div class="col-sm-10">
            <input  list = "cities" class="form-control" type ="Text" name="city" id="city" placeholder="Enter city , (First few letters of your city)">
            <datalist  id="cities">
              <option></option>
            </datalist>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10 center">
          <button type="submit" id="submit_button" class="btn btn-info">Search</button>
        </div>
      </div>
</form>
</div>

<br>
<h1 align ="center"style="color: green" ><b> Cases in Each State</b></h1>

<div class="section-bg pt-5 pb-5 px-5" id="introduction">
  <div class="container">

  <table  class="table table-striped table" border=1 width=100%>
  <thead class= "thead-dark">
  <tr>
    <th>Sr No.</th>
    <th>State</th>
    <th>Confirmed </th>
    <th>Deaths</th>
    <th>Recovered</th>
    <th>Active</th>
  </tr>
  </thead>
  <tbody>
    {% for state in states_cases %}
    <tr>
      <td>{{state.pk}}</td>
      <td><a href="{% url 'city' state.state_name %}">{{state.state_name}}</a></td>
      <td>{{state.confirmed}}</td>
      <td>{{state.Death}}</td>
      <td>{{state.Recovered}}</td>
      <td>{{state.Active}}</td>
    </tr>
  {% endfor %}
  </tbody>
  </table>
  </div>
</div>

<br>
<div class="section-bg title-box">
  <div class="container">
      <div class="title-box text-center">
          <h3 class="title-a">
              ABOUT
          </h3>
          <hr class="titlehr" />
          <p class="font-italic "><br>{{about_intro|safe}}</p>
          <div class="text-dark text-center px-3">
              <h3 class="subtitle-a">*Contact*</h3>
              <p class="font-bold">Tushar Rao: <a href="https://github.com/tusharrao198/"><i  class="fa fa-github" aria-hidden="true">GTIHUB</i></a></p>
              <p class="fa fa-map-github"></p>
          </div>
      </div>
  </div>
</div>
{% endblock %}

{% block script %}
  <script type="text/javascript">
    let js = $.getJSON("https://api.covid19india.org/state_district_wise.json", "jsonp");
    // console.log("success");
    
    const my_form = document.querySelector("#city");
    my_form.addEventListener('mouseover', abcd);  
    // console.log(spaceData);
    var state_check_if_same = "";
    var previous_data = "";
    function abcd(e){
      e.preventDefault();
      if (Object.keys(js).length!=0)
        {
          const state = document.querySelector("#state");
          let state_name = state.value;
          console.log(state_name);
          if (state_name.length!=0 && state_check_if_same!=state_name)
          {
            state_check_if_same = state_name;
            // console.log(js["responseJSON"]);
            let options = js["responseJSON"][state_name]['districtData'];
            // console.log(Object.keys(options).length);
            let citi = [];

            for (let key in options) {
              citi.push(key);
            }
            // console.log(citi);

            if (citi.length==0){
              console.log(`Data was not recieved for State = ${state_name}`)
            }
            let cities = document.querySelector("#cities");
            if (previous_data.length!=0) {
              for(let i = 0; i < previous_data.length; i++) {
                // let opt = citi[i];
                // let el = document.getElementById("option");
                // el.textContent = opt;
                // el.value = opt;
                cities.removeChild(cities.lastElementChild);
              }
            }
            
            for(let i = 0; i < citi.length; i++) {
              let opt = citi[i];
              let el = document.createElement("option");
              el.textContent = opt;
              el.value = opt;
              cities.appendChild(el);
            }
            previous_data = citi;
          }
        }
    }

    let input_fields_check = document.querySelector("#submit_button");
    input_fields_check.addEventListener('click', check_search);
    function check_search(e) {
      e.preventDefault();
      let state_input = document.querySelector("#state");
      let city_input = document.querySelector("#city");
      let s = state_input.value;
      let c = city_input.value;
      let msg = document.querySelector(".msg");
      // console.log("SASD",s.length);
      if (s.length==0 || c.length==0){
        // console.log("0000000",s,"000000000000",c);
        document.getElementById("submit_button").disabled = true;
        // msg.classList.add("error");
        // msg.innerHTML = "Please Select!";

        // setTimeout(() => msg.remove(), 3000);
      }
      document.getElementById("submit_button").disabled = false;
    }
    let form_ = document.getElementById("find_cases");
    input_fields_check.addEventListener('click', enableBtn);
    function enableBtn() {
      let state_input = document.querySelector("#state");
      let city_input = document.querySelector("#city");
      let s = state.value;
      let c = city.value;
      // console.log("SSDDSDSDSSFSFSFSF")
      if (s.length!=0 && c.length!=0){
        // console.log("S",s,"C",c);
        document.getElementById("submit_button").disabled = false;
        form_.submit();
      }
    }
  </script>
{% endblock %}

